<div class="user-management">
    <div class="page-header">
      <h2>User Management</h2>
      <div class="header-actions">
        <select [(ngModel)]="statusFilter" (change)="applyFilters()" class="filter-select">
          <option value="">All Users</option>
          <option value="true">Active Users</option>
          <option value="false">Inactive Users</option>
        </select>
        <button (click)="loadUsers()" class="refresh-btn">
          <i class="fas fa-sync"></i>
          Refresh
        </button>
      </div>
    </div>
  
    <!-- Loading -->
    <div *ngIf="loading" class="loading">
      <div class="spinner"></div>
      <p>Loading users...</p>
    </div>
  
    <!-- Error -->
    <div *ngIf="error" class="error-message">
      <i class="fas fa-exclamation-triangle"></i>
      <p>{{ error }}</p>
    </div>
  
    <!-- Users Table -->
    <div *ngIf="!loading && !error" class="users-table-container">
      <table class="users-table">
        <thead>
          <tr>
            <th>User</th>
            <th>Email</th>
            <th>Roles</th>
            <th>Status</th>
            <th>Activity</th>
            <th>Joined</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let user of users" class="user-row">
            <td class="user-info">
              <div class="user-avatar">
                {{ user.firstName.charAt(0) }}{{ user.lastName.charAt(0) }}
              </div>
              <div class="user-details">
                <span class="user-name">{{ user.firstName }} {{ user.lastName }}</span>
                <span class="username">@{{ user.userName }}</span>
              </div>
            </td>
            <td class="user-email">
              {{ user.email }}
              <i *ngIf="user.emailConfirmed" class="fas fa-check-circle verified" title="Email Verified"></i>
              <i *ngIf="!user.emailConfirmed" class="fas fa-exclamation-circle unverified" title="Email Not Verified"></i>
            </td>
            <td class="user-roles">
              <span *ngFor="let role of user.roles" 
                    class="role-badge" 
                    [ngClass]="{'admin': role === 'Admin', 'user': role === 'User'}">
                {{ role }}
              </span>
            </td>
            <td class="user-status">
              <span class="status-badge" 
                    [ngClass]="{'active': user.isActive, 'inactive': !user.isActive}">
                {{ user.isActive ? 'Active' : 'Inactive' }}
              </span>
            </td>
            <td class="user-activity">
              <div class="activity-stats">
                <span class="stat">
                  <i class="fas fa-question-circle"></i>
                  {{ user.questionsCount }} questions
                </span>
                <span class="stat">
                  <i class="fas fa-comments"></i>
                  {{ user.answersCount }} answers
                </span>
              </div>
            </td>
            <td class="user-joined">
              {{ user.createdAt | date:'shortDate' }}
            </td>
            <td class="user-actions">
              <div class="action-buttons">
                <button (click)="toggleUserStatus(user)" 
                        class="action-btn" 
                        [ngClass]="user.isActive ? 'deactivate' : 'activate'"
                        [disabled]="processingIds.has(user.id)"
                        title="{{ user.isActive ? 'Deactivate' : 'Activate' }} User">
                  <i [class]="user.isActive ? 'fas fa-user-slash' : 'fas fa-user-check'"></i>
                </button>
                
                <button (click)="openRoleModal(user)" 
                        class="action-btn edit"
                        title="Edit Roles">
                  <i class="fas fa-user-tag"></i>
                </button>
                
                <button (click)="deleteUser(user)" 
                        class="action-btn delete"
                        [disabled]="processingIds.has(user.id) || user.roles.includes('Admin')"
                        title="Delete User">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
  
      <!-- No Users -->
      <div *ngIf="users.length === 0" class="no-data">
        <i class="fas fa-users"></i>
        <h3>No Users Found</h3>
        <p>No users match the current filter criteria.</p>
      </div>
    </div>
  
    <!-- Pagination -->
    <div *ngIf="totalPages > 1" class="pagination">
      <button (click)="changePage(currentPage - 1)" 
              [disabled]="currentPage === 1"
              class="page-btn">
        <i class="fas fa-chevron-left"></i>
      </button>
      
      <span class="page-info">
        Page {{ currentPage }} of {{ totalPages }}
      </span>
      
      <button (click)="changePage(currentPage + 1)" 
              [disabled]="currentPage === totalPages"
              class="page-btn">
        <i class="fas fa-chevron-right"></i>
      </button>
    </div>
  </div>
  
  <!-- Role Edit Modal -->
  <div *ngIf="showRoleModal" class="modal-overlay" (click)="closeRoleModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Edit User Roles</h3>
        <button (click)="closeRoleModal()" class="close-btn">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="modal-body">
        <p>Editing roles for: <strong>{{ selectedUser?.firstName }} {{ selectedUser?.lastName }}</strong></p>
        
        <div class="role-options">
          <label class="role-option">
            <input type="checkbox" 
                   [checked]="editingRoles.includes('User')"
                   (change)="toggleRole('User', $event)">
            <span>User</span>
          </label>
          <label class="role-option">
            <input type="checkbox" 
                   [checked]="editingRoles.includes('Admin')"
                   (change)="toggleRole('Admin', $event)">
            <span>Admin</span>
          </label>
        </div>
      </div>
      
      <div class="modal-footer">
        <button (click)="closeRoleModal()" class="btn btn-secondary">Cancel</button>
        <button (click)="saveUserRoles()" 
                class="btn btn-primary"
                [disabled]="savingRoles">
          {{ savingRoles ? 'Saving...' : 'Save Changes' }}
        </button>
      </div>
    </div>
  </div>
  